# 🤖 智能字段映射功能使用说明

## 功能概述

智能字段映射是薪资批量导入中的AI增强功能，通过多种字符串匹配算法自动推荐最佳的字段映射关系，大幅提升映射效率和准确性。

## 核心算法

### 1. **Levenshtein距离算法**
- 计算两个字符串的编辑距离
- 适用于检测拼写错误和变体
- 示例：`基本工资` vs `基础工资` → 相似度: 75%

### 2. **Jaro-Winkler相似度**
- 专为短字符串设计的相似度算法
- 给予字符串前缀更高权重
- 示例：`员工姓名` vs `姓名` → 相似度: 85%

### 3. **包含关系检查**
- 检测一个字符串是否包含另一个
- 对业务字段特别有效
- 示例：`个人所得税` vs `个税` → 相似度: 90%

### 4. **规则匹配系统**
- 基于预定义的中文业务词汇规则
- 支持关键词匹配和同义词识别
- 示例：`公积金` → 自动匹配到 `住房公积金`

## 使用步骤

### 步骤1：上传数据
1. 在第一步上传包含中文字段名的Excel/CSV文件
2. 系统自动识别源字段列表

### 步骤2：执行智能映射
1. 点击 **"智能映射"** 按钮
2. 系统分析每个源字段，计算与目标字段的相似度
3. 生成智能映射推荐结果

### 步骤3：查看分析结果
智能映射分析面板显示：
- **映射进度**：已映射字段百分比
- **智能质量分**：基于置信度的综合评分
- **置信度分布**：
  - 🟢 高置信度 (≥70%)：可直接应用
  - 🟠 中等置信度 (40-70%)：建议人工确认
  - 🔴 低置信度 (≤40%)：需要手动调整

### 步骤4：应用推荐
1. **自动应用**：点击 **"应用推荐"** 按钮，自动应用高置信度匹配
2. **手动选择**：点击源字段下方的推荐标签，选择特定推荐
3. **人工调整**：使用下拉框手动设置低置信度字段

## 支持的字段类型

### 基础信息字段
- `员工姓名`、`姓名`、`人员姓名` → `employee_full_name`
- `工号`、`员工编号`、`员工号` → `employee_code`
- `部门`、`科室`、`单位` → `department`
- `身份证号`、`身份证号码` → `id_number`

### 收入字段
- `基本工资`、`基础工资` → `earnings_details.BASIC_SALARY.amount`
- `岗位工资`、`岗位` → `earnings_details.POSITION_SALARY_GENERAL.amount`
- `绩效工资`、`绩效`、`奖励绩效` → `earnings_details.PERFORMANCE_SALARY.amount`
- `津贴`、`补贴` → `earnings_details.GENERAL_ALLOWANCE.amount`

### 扣除字段
- `个人所得税`、`个税`、`所得税` → `deductions_details.PERSONAL_INCOME_TAX.amount`
- `养老保险`、`养老` → `deductions_details.PENSION_PERSONAL_AMOUNT.amount`
- `住房公积金`、`公积金` → `deductions_details.HOUSING_FUND_PERSONAL.amount`

### 汇总字段
- `应发`、`应发工资`、`应发合计` → `gross_pay`
- `实发`、`实发工资`、`净工资` → `net_pay`
- `扣除`、`扣发`、`总扣除` → `total_deductions`

## 置信度评估

### 高置信度 (70%+)
- **直接匹配**：字段名完全一致
- **强规则匹配**：命中预定义关键词规则
- **高相似度**：字符串相似度超过70%

### 中等置信度 (40-70%)
- **部分匹配**：字段名部分相似
- **弱规则匹配**：包含相关关键词但不完全匹配
- **中等相似度**：算法计算的相似度在中等范围

### 低置信度 (≤40%)
- **弱相似性**：字段名相似度较低
- **无规则匹配**：未命中任何预定义规则
- **需要人工判断**：建议手动设置映射

## 最佳实践

### 1. 数据准备
- 确保Excel表头使用标准的中文业务术语
- 避免使用简写或非标准缩写
- 保持字段名称的一致性

### 2. 映射策略
- 优先应用高置信度推荐
- 仔细检查中等置信度字段
- 手动处理低置信度和无匹配字段

### 3. 质量控制
- 目标质量分：≥80分
- 映射完成度：100%
- 关键字段（姓名、工号、身份证）必须正确映射

## 常见映射示例

### 完美匹配 (100%)
```
源字段: "员工姓名" → 目标: "员工姓名" (employee_full_name)
源字段: "基本工资" → 目标: "基本工资" (earnings_details.BASIC_SALARY.amount)
```

### 高置信度匹配 (90%+)
```
源字段: "姓名" → 目标: "员工姓名" (employee_full_name)
源字段: "个税" → 目标: "个人所得税" (deductions_details.PERSONAL_INCOME_TAX.amount)
```

### 中等置信度匹配 (50-70%)
```
源字段: "工资" → 可能目标: "基本工资"、"岗位工资"、"绩效工资"
源字段: "保险" → 可能目标: "养老保险"、"医疗保险"、"失业保险"
```

## 故障排除

### 问题1：智能映射无推荐
**原因**：源字段与目标字段差异过大
**解决**：检查字段名称是否使用标准术语，考虑手动映射

### 问题2：推荐不准确
**原因**：字段名称含义模糊或有歧义
**解决**：优先使用人工选择，完善源数据字段命名

### 问题3：置信度普遍偏低
**原因**：数据格式非标准化
**解决**：重新整理源数据，使用标准的中文业务术语

## 技术说明

### 算法权重配置
```typescript
// 综合相似度计算
const compositeSimilarity = 
  levenshtein * 0.3 +        // 编辑距离：30%
  jaroWinkler * 0.3 +        // Jaro-Winkler：30%
  containsMatch * 0.4;       // 包含关系：40%
```

### 置信度提升规则
- 规则匹配时额外+20%置信度
- 完全匹配时置信度=100%
- 最低推荐阈值=30%

通过智能字段映射功能，您可以将原本需要几十分钟的手动映射工作缩短到几分钟，同时大幅减少映射错误，提升数据导入的效率和准确性。 