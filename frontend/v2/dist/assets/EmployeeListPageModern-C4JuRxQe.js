import{s as e,M as a,j as t,S as s,F as o,J as l,k as r,e as n,l as m,B as c,au as i,b as d,R as p,r as u,t as y,I as h,u as x,a as g}from"./antd-vendor-DWzn6iQK.js";import{u as j,b}from"./react-vendor-D9vUlElp.js";import{M as f,a as v}from"./index-Rv_gV0PU.js";import{f as C,g as k,a as w,H as S,T as _,b as N,O as z}from"./hr-management-D97vxp0y.js";import{e as E}from"./employee-service-D8n0hVPx.js";import{u as I}from"./i18n-vendor-DF0Yg0Xi.js";import"./state-vendor-BIBp6L7x.js";import"./admin-management-CYhSgojJ.js";import"./payroll-management-BvFUgCwh.js";import"./utils-vendor-CFhz7Dje.js";const M={current:1,pageSize:10,total:0},T={},A={},O=()=>{const{t:O}=I(["employee","common"]),P=j(),[B,D]=b.useState([]),[F,K]=b.useState(!1),[R,$]=b.useState(M),[H,q]=b.useState(T),[J,U]=b.useState(A),[V,W]=b.useState(""),[G,L]=b.useState([]),{lookupMaps:Q,loading:X}=C(),{permissions:Y}=k(),{searchProps:Z}=w(["full_name","employee_code","department_name","position_name"]),ee=b.useCallback((async()=>{try{K(!0);const e={page:R.current||1,size:R.pageSize||10,sortBy:H.field,sortOrder:"ascend"===H.order?"asc":"descend"===H.order?"desc":void 0,...J},a=await E.getEmployeesFromView(e);D(a||[]),$((e=>({...e,total:(null==a?void 0:a.length)||0,current:R.current||1,pageSize:R.pageSize||10})))}catch(a){e.error(O("common:fetchError"))}finally{K(!1)}}),[R.current,R.pageSize,H,J,O]);b.useEffect((()=>{ee()}),[ee]);const ae=b.useCallback(((e,a,t)=>{const s=(Array.isArray(t)?t:[t])[0];$(e),q({field:null==s?void 0:s.field,order:null===(null==s?void 0:s.order)||null==s?void 0:s.order})}),[]),te=b.useCallback((e=>{W(e),U((a=>({...a,full_name_contains:e||void 0}))),$((e=>({...e,current:1})))}),[]),se=b.useCallback((()=>{ee()}),[ee]),oe=b.useCallback((e=>{P(`/hr/employees/${e.id}`)}),[P]),le=b.useCallback((e=>{P(`/hr/employees/${e.id}/edit`)}),[P]),re=b.useCallback((async t=>{a.confirm({title:O("employee:deleteConfirmTitle"),content:O("employee:deleteConfirmContent",{name:t.full_name}),okText:O("common:confirm"),cancelText:O("common:cancel"),okType:"danger",onOk:async()=>{try{await E.deleteEmployee(t.id.toString()),e.success(O("employee:deleteSuccess")),ee()}catch(a){e.error(O("employee:deleteError"))}}})}),[O,ee]),ne=[{title:O("employee:employeeCode"),dataIndex:"employee_code",key:"employee_code",width:120,sorter:!0,...Z,render:e=>t.jsx("span",{className:"typography-caption-strong",children:e})},{title:O("employee:fullName"),dataIndex:"full_name",key:"full_name",width:150,sorter:!0,...Z,render:(e,a)=>t.jsxs(s,{children:[t.jsx(o,{className:"text-accent"}),t.jsx(S,{highlightClassName:"bg-yellow-200",searchWords:[V],textToHighlight:String(e||""),className:"typography-body font-medium"})]})},{title:O("employee:department"),dataIndex:"department_name",key:"department_name",width:150,sorter:!0,...Z,render:e=>t.jsxs(s,{children:[t.jsx(l,{className:"text-accent"}),t.jsx("span",{className:"typography-body",children:e})]})},{title:O("employee:position"),dataIndex:"position_name",key:"position_name",width:150,sorter:!0,...Z,render:e=>t.jsx("span",{className:"typography-body",children:e})},{title:O("employee:status"),dataIndex:"employee_status",key:"employee_status",width:100,sorter:!0,render:e=>{const a={"在职":{color:"success",text:O("employee:statusActive")},"离职":{color:"error",text:O("employee:statusInactive")},"试用":{color:"warning",text:O("employee:statusProbation")}}[e]||{color:"default",text:e};return t.jsx("span",{className:`ant-tag ant-tag-${a.color} typography-caption-strong`,children:a.text})}},{title:O("common:column.actions"),key:"actions",width:160,fixed:"right",render:(e,a)=>t.jsxs(s,{size:"small",children:[t.jsx(_,{icon:t.jsx(r,{}),onClick:()=>oe(a),title:O("common:view"),type:"primary",size:"small",className:"modern-button variant-ghost size-sm"}),Y.canUpdate&&t.jsx(_,{icon:t.jsx(n,{}),onClick:()=>le(a),title:O("common:edit"),size:"small",className:"modern-button variant-secondary size-sm"}),Y.canDelete&&t.jsx(_,{icon:t.jsx(m,{}),onClick:()=>re(a),title:O("common:delete"),danger:!0,size:"small",className:"modern-button variant-danger size-sm"})]})}],{exportToExcel:me}=N(B,ne),ce=b.useCallback((async()=>{try{await me(),e.success(O("common:exportSuccess"))}catch(a){e.error(O("common:exportError"))}}),[me,O]),ie=t.jsxs(s,{children:[t.jsx(c,{icon:t.jsx(i,{}),onClick:se,loading:F,className:"modern-button variant-ghost",children:O("common:refresh")}),t.jsx(c,{icon:t.jsx(d,{}),onClick:ce,className:"modern-button variant-secondary",children:O("common:export.export")}),Y.canCreate&&t.jsx(c,{type:"primary",icon:t.jsx(p,{}),onClick:()=>P("/hr/employees/create"),className:"modern-button variant-primary",children:O("employee:addEmployee")})]}),de=[{title:O("common:home"),href:"/"},{title:O("common:hrManagement"),href:"/hr"},{title:O("employee:employeeManagement")}];return t.jsxs(f,{title:O("employee:employeeManagement"),subtitle:O("employee:employeeManagementDescription"),headerExtra:ie,showBreadcrumb:!0,breadcrumbItems:de,children:[t.jsx(v,{title:O("common:searchAndFilter"),icon:t.jsx(g,{}),variant:"outlined",className:"mb-6",children:t.jsxs(u,{gutter:[16,16],children:[t.jsx(y,{xs:24,sm:12,md:8,lg:6,children:t.jsx(h.Search,{placeholder:O("employee:searchPlaceholder"),allowClear:!0,onSearch:te,onChange:e=>{e.target.value||te("")},className:"w-full"})}),t.jsx(y,{xs:24,sm:12,md:8,lg:6,children:t.jsx(x,{placeholder:O("employee:selectDepartment"),allowClear:!0,options:(null==Q?void 0:Q.departmentMap)?Object.values(Q.departmentMap).map((e=>({label:e.name,value:e.id}))):[],onChange:e=>{U((a=>({...a,department_name_contains:e||void 0}))),$((e=>({...e,current:1})))},className:"w-full"})}),t.jsx(y,{xs:24,sm:12,md:8,lg:6,children:t.jsx(x,{placeholder:O("employee:selectStatus"),allowClear:!0,options:[{label:O("employee:statusActive"),value:"在职"},{label:O("employee:statusInactive"),value:"离职"},{label:O("employee:statusProbation"),value:"试用"}],onChange:e=>{U((a=>({...a,employee_status_equals:e||void 0}))),$((e=>({...e,current:1})))},className:"w-full"})})]})}),t.jsx(v,{children:t.jsx(z,{columns:ne,dataSource:B,loading:F||X,pagination:R,onChange:ae,rowKey:"employee_id",rowSelection:{selectedRowKeys:G,onChange:L,preserveSelectedRowKeys:!0},scroll:{x:1e3},size:"small"})})]})};export{O as default};
