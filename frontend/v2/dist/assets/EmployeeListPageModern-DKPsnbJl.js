import{s as e,M as a,j as t,S as s,F as o,J as r,k as l,e as n,l as i,B as c,au as m,b as d,R as p,r as u,t as y,I as g,u as h,a as x}from"./antd-vendor-C1V4cVms.js";import{u as j,b as f}from"./react-vendor-D9vUlElp.js";import{M as v,a as b}from"./index-CNoCQzrU.js";import{f as C,g as w,a as S,H as z,T as k,b as _,O as N}from"./hr-management-Bxz25n3J.js";import{e as E}from"./employee-service-EoGCXWnj.js";import{u as M}from"./useRenderCount-CIqEsBom.js";import{u as I}from"./i18n-vendor-DF0Yg0Xi.js";import"./state-vendor-BIBp6L7x.js";import"./admin-management-B_B4TQCC.js";import"./payroll-management-BhhUn9Iu.js";import"./utils-vendor-CFhz7Dje.js";const O={current:1,pageSize:10,total:0},T={},B={},A=()=>{const{t:A}=I(["employee","common"]),P=j(),[R,D]=f.useState([]),[F,K]=f.useState(!1),[$,H]=f.useState(O),[L,q]=f.useState(T),[J,U]=f.useState(B),[V,W]=f.useState(""),[G,Q]=f.useState([]),{lookupMaps:X,loading:Y}=C(),{permissions:Z}=w(),{searchProps:ee}=S(["full_name","employee_code","department_name","position_name"]),{renderCount:ae,isExcessive:te}=M({componentName:"EmployeeListPageModern",warningThreshold:5,enableLogging:!0}),se=f.useCallback((async a=>{try{K(!0);const e={page:(null==a?void 0:a.page)||$.current||1,size:(null==a?void 0:a.size)||$.pageSize||10,sortBy:(null==a?void 0:a.sortBy)||L.field,sortOrder:(null==a?void 0:a.sortOrder)||("ascend"===L.order?"asc":"descend"===L.order?"desc":void 0),...J,...a},t=await E.getEmployeesFromView(e);return D(t||[]),{data:t||[],total:(null==t?void 0:t.length)||0,page:e.page,size:e.size}}catch(t){return e.error(A("common:fetchError")),{data:[],total:0,page:$.current||1,size:$.pageSize||10}}finally{K(!1)}}),[A,L.field,L.order,J]);f.useEffect((()=>{(async()=>{const e=await se();e&&H((a=>({...a,total:e.total,current:e.page,pageSize:e.size})))})()}),[]),f.useEffect((()=>{(1!==$.current||10!==$.pageSize||L.field||Object.keys(J).length>0)&&(async()=>{const e=await se({page:$.current,size:$.pageSize,sortBy:L.field,sortOrder:"ascend"===L.order?"asc":"descend"===L.order?"desc":void 0});e&&H((a=>({...a,total:e.total})))})()}),[$.current,$.pageSize,L.field,L.order,J,se]);const oe=f.useCallback(((e,a,t)=>{const s=(Array.isArray(t)?t:[t])[0];H(e),q({field:null==s?void 0:s.field,order:null===(null==s?void 0:s.order)||null==s?void 0:s.order})}),[]),re=f.useCallback((e=>{W(e),U((a=>({...a,full_name_contains:e||void 0}))),H((e=>({...e,current:1})))}),[]),le=f.useCallback((async()=>{const e=await se({page:$.current,size:$.pageSize,sortBy:L.field,sortOrder:"ascend"===L.order?"asc":"descend"===L.order?"desc":void 0});e&&H((a=>({...a,total:e.total})))}),[se,$.current,$.pageSize,L.field,L.order]),ne=f.useCallback((e=>{P(`/hr/employees/${e.id}`)}),[P]),ie=f.useCallback((e=>{P(`/hr/employees/${e.id}/edit`)}),[P]),ce=f.useCallback((async t=>{a.confirm({title:A("employee:deleteConfirmTitle"),content:A("employee:deleteConfirmContent",{name:t.full_name}),okText:A("common:confirm"),cancelText:A("common:cancel"),okType:"danger",onOk:async()=>{try{await E.deleteEmployee(t.id.toString()),e.success(A("employee:deleteSuccess"));const a=await se({page:$.current,size:$.pageSize,sortBy:L.field,sortOrder:"ascend"===L.order?"asc":"descend"===L.order?"desc":void 0});a&&H((e=>({...e,total:a.total})))}catch(a){e.error(A("employee:deleteError"))}}})}),[A,se,$.current,$.pageSize,L.field,L.order]),me=[{title:A("employee:employeeCode"),dataIndex:"employee_code",key:"employee_code",width:120,sorter:!0,...ee,render:e=>t.jsx("span",{className:"typography-caption-strong",children:e})},{title:A("employee:fullName"),dataIndex:"full_name",key:"full_name",width:150,sorter:!0,...ee,render:(e,a)=>t.jsxs(s,{children:[t.jsx(o,{className:"text-accent"}),t.jsx(z,{highlightClassName:"bg-yellow-200",searchWords:[V],textToHighlight:String(e||""),className:"typography-body font-medium"})]})},{title:A("employee:department"),dataIndex:"department_name",key:"department_name",width:150,sorter:!0,...ee,render:e=>t.jsxs(s,{children:[t.jsx(r,{className:"text-accent"}),t.jsx("span",{className:"typography-body",children:e})]})},{title:A("employee:position"),dataIndex:"position_name",key:"position_name",width:150,sorter:!0,...ee,render:e=>t.jsx("span",{className:"typography-body",children:e})},{title:A("employee:status"),dataIndex:"employee_status",key:"employee_status",width:100,sorter:!0,render:e=>{const a={"在职":{color:"success",text:A("employee:statusActive")},"离职":{color:"error",text:A("employee:statusInactive")},"试用":{color:"warning",text:A("employee:statusProbation")}}[e]||{color:"default",text:e};return t.jsx("span",{className:`ant-tag ant-tag-${a.color} typography-caption-strong`,children:a.text})}},{title:A("common:column.actions"),key:"actions",width:160,fixed:"right",render:(e,a)=>t.jsxs(s,{size:"small",children:[t.jsx(k,{icon:t.jsx(l,{}),onClick:()=>ne(a),title:A("common:view"),type:"primary",size:"small",className:"modern-button variant-ghost size-sm"}),Z.canUpdate&&t.jsx(k,{icon:t.jsx(n,{}),onClick:()=>ie(a),title:A("common:edit"),size:"small",className:"modern-button variant-secondary size-sm"}),Z.canDelete&&t.jsx(k,{icon:t.jsx(i,{}),onClick:()=>ce(a),title:A("common:delete"),danger:!0,size:"small",className:"modern-button variant-danger size-sm"})]})}],{exportToExcel:de}=_(R,me),pe=f.useCallback((async()=>{try{await de(),e.success(A("common:exportSuccess"))}catch(a){e.error(A("common:exportError"))}}),[de,A]),ue=t.jsxs(s,{children:[t.jsx(c,{icon:t.jsx(m,{}),onClick:le,loading:F,className:"modern-button variant-ghost",children:A("common:refresh")}),t.jsx(c,{icon:t.jsx(d,{}),onClick:pe,className:"modern-button variant-secondary",children:A("common:export.export")}),Z.canCreate&&t.jsx(c,{type:"primary",icon:t.jsx(p,{}),onClick:()=>P("/hr/employees/create"),className:"modern-button variant-primary",children:A("employee:addEmployee")})]}),ye=[{title:A("common:home"),href:"/"},{title:A("common:hrManagement"),href:"/hr"},{title:A("employee:employeeManagement")}];return t.jsxs(v,{title:A("employee:employeeManagement"),subtitle:A("employee:employeeManagementDescription"),headerExtra:ue,showBreadcrumb:!0,breadcrumbItems:ye,children:[t.jsx(b,{title:A("common:searchAndFilter"),icon:t.jsx(x,{}),variant:"outlined",className:"mb-6",children:t.jsxs(u,{gutter:[16,16],children:[t.jsx(y,{xs:24,sm:12,md:8,lg:6,children:t.jsx(g.Search,{placeholder:A("employee:searchPlaceholder"),allowClear:!0,onSearch:re,onChange:e=>{e.target.value||re("")},className:"w-full"})}),t.jsx(y,{xs:24,sm:12,md:8,lg:6,children:t.jsx(h,{placeholder:A("employee:selectDepartment"),allowClear:!0,options:(null==X?void 0:X.departmentMap)?Object.values(X.departmentMap).map((e=>({label:e.name,value:e.id}))):[],onChange:e=>{U((a=>({...a,department_name_contains:e||void 0}))),H((e=>({...e,current:1})))},className:"w-full"})}),t.jsx(y,{xs:24,sm:12,md:8,lg:6,children:t.jsx(h,{placeholder:A("employee:selectStatus"),allowClear:!0,options:[{label:A("employee:statusActive"),value:"在职"},{label:A("employee:statusInactive"),value:"离职"},{label:A("employee:statusProbation"),value:"试用"}],onChange:e=>{U((a=>({...a,employee_status_equals:e||void 0}))),H((e=>({...e,current:1})))},className:"w-full"})})]})}),t.jsx(b,{children:t.jsx(N,{columns:me,dataSource:R,loading:F||Y,pagination:$,onChange:oe,rowKey:"employee_id",rowSelection:{selectedRowKeys:G,onChange:Q,preserveSelectedRowKeys:!0},scroll:{x:1e3},size:"small"})})]})};export{A as default};
