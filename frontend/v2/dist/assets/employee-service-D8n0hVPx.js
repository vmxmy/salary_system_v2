var e=Object.defineProperty,t=(t,a,r)=>((t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r)(t,"symbol"!=typeof a?a+"":a,r);import{c as a,a as r,b as o}from"./state-vendor-BIBp6L7x.js";import{a as s}from"./utils-vendor-CFhz7Dje.js";import{s as n}from"./antd-vendor-DWzn6iQK.js";const i={token:"",baseUrl:"",customCss:"",customJs:"",isEnabled:!0,systemVariables:[{key:"scene",value_type:"string",value:"general",label:"Scene"},{key:"lib_search_topk",value_type:"number",value:3,label:"Top K"}]},l=a({name:"chatbotConfig",initialState:{config:i,isEnabled:void 0===i.isEnabled||i.isEnabled,isConfigured:!!i.token,isLoading:!0},reducers:{setHydratedChatbotState:(e,t)=>{e.config=t.payload.config,e.isEnabled=t.payload.isEnabled,e.isConfigured=t.payload.isConfigured,e.isLoading=!1},setInitialChatbotState:e=>{e.config=i,e.isEnabled=void 0===i.isEnabled||i.isEnabled,e.isConfigured=!!i.token,e.isLoading=!1},updateChatbotConfig:(e,t)=>{const a={...e.config,...t.payload};void 0===t.payload.systemVariables&&e.config.systemVariables?a.systemVariables=e.config.systemVariables:null===t.payload.systemVariables||void 0===t.payload.systemVariables?a.systemVariables=[]:a.systemVariables=t.payload.systemVariables,e.config=a,e.isConfigured=!!e.config.token},setChatbotEnabled:(e,t)=>{e.isEnabled=t.payload}}}),{setHydratedChatbotState:d,setInitialChatbotState:c,updateChatbotConfig:u,setChatbotEnabled:p}=l.actions,y=l.reducer,g=e=>e.chatbotConfig.isEnabled,m=e=>e.chatbotConfig.isConfigured,h=e=>e.chatbotConfig.isLoading,v=e=>e.chatbotConfig.config.token,f=e=>e.chatbotConfig.config.baseUrl,w=e=>e.chatbotConfig.config.customCss,b=e=>e.chatbotConfig.config.customJs,S=e=>e.chatbotConfig.config.systemVariables;class E extends Error{}function _(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function(e){return decodeURIComponent(atob(e).replace(/(.)/g,((e,t)=>{let a=t.charCodeAt(0).toString(16).toUpperCase();return a.length<2&&(a="0"+a),"%"+a})))}(t)}catch(a){return atob(t)}}function L(e,t){if("string"!=typeof e)throw new E("Invalid token specified: must be a string");t||(t={});const a=!0===t.header?0:1,r=e.split(".")[a];if("string"!=typeof r)throw new E(`Invalid token specified: missing part #${a+1}`);let o;try{o=_(r)}catch(s){throw new E(`Invalid token specified: invalid base64 for part #${a+1} (${s.message})`)}try{return JSON.parse(o)}catch(s){throw new E(`Invalid token specified: invalid json for part #${a+1} (${s.message})`)}}E.prototype.name="InvalidTokenError";const k=new class{constructor(){t(this,"metrics",[]),t(this,"MAX_METRICS",1e3),t(this,"SLOW_REQUEST_THRESHOLD",1e3),t(this,"VERY_SLOW_REQUEST_THRESHOLD",3e3)}recordMetric(e){this.metrics.push(e),this.metrics.length>this.MAX_METRICS&&this.metrics.shift()}logSlowRequests(e){const{url:t,method:a,duration:r,status:o}=e;r>this.VERY_SLOW_REQUEST_THRESHOLD||this.SLOW_REQUEST_THRESHOLD}getPerformanceStats(){if(0===this.metrics.length)return null;const e=this.metrics.map((e=>e.duration)),t=this.metrics.filter((e=>e.duration>this.SLOW_REQUEST_THRESHOLD)),a=this.metrics.filter((e=>e.duration>this.VERY_SLOW_REQUEST_THRESHOLD)),r=this.metrics.reduce(((e,t)=>{const a=`${t.method} ${t.url}`;e[a]||(e[a]={count:0,totalDuration:0,avgDuration:0,maxDuration:0,minDuration:1/0});const r=e[a];return r.count++,r.totalDuration+=t.duration,r.avgDuration=r.totalDuration/r.count,r.maxDuration=Math.max(r.maxDuration,t.duration),r.minDuration=Math.min(r.minDuration,t.duration),e}),{});return{totalRequests:this.metrics.length,averageDuration:e.reduce(((e,t)=>e+t),0)/e.length,maxDuration:Math.max(...e),minDuration:Math.min(...e),slowRequestsCount:t.length,verySlowRequestsCount:a.length,slowRequestsPercentage:t.length/this.metrics.length*100,urlStats:r,recentSlowRequests:t.slice(-10)}}getSlowestRequests(e=10){return[...this.metrics].sort(((e,t)=>t.duration-e.duration)).slice(0,e)}clearMetrics(){this.metrics=[]}exportReport(){const e=this.getPerformanceStats(),t=this.getSlowestRequests();return{timestamp:(new Date).toISOString(),summary:e,slowestRequests:t,recommendations:this.generateRecommendations(e)}}generateRecommendations(e){const t=[];if((null==e?void 0:e.slowRequestsPercentage)>20&&t.push("超过20%的请求响应时间过长，建议优化后端性能"),(null==e?void 0:e.verySlowRequestsCount)>0&&t.push("存在响应时间超过3秒的极慢请求，需要重点优化"),(null==e?void 0:e.averageDuration)>500&&t.push("平均响应时间超过500ms，建议检查网络连接或后端性能"),null==e?void 0:e.urlStats){const a=Object.entries(e.urlStats).sort((([,e],[,t])=>t.avgDuration-e.avgDuration)).slice(0,3);a.length>0&&t.push(`最慢的接口: ${a.map((([e,t])=>`${e} (${t.avgDuration.toFixed(2)}ms)`)).join(", ")}`)}return t}};let C=!1,T=[];const A=(e,t=null)=>{T.forEach((a=>{e?a.reject(e):a.resolve(t)})),T=[]},U=e=>{var t,a;return(e=>!(e.response||!e.message||!(e.message.includes("Network Error")||e.message.includes("Failed to fetch")||e.message.includes("connect ECONNREFUSED")))||!(!e.response||500!==e.response.status))(e)?"Server unavailable or network error":(null==(a=null==(t=e.response)?void 0:t.data)?void 0:a.detail)?"string"==typeof e.response.data.detail?e.response.data.detail:JSON.stringify(e.response.data.detail):e.message?String(e.message):"An unknown error occurred"},P=["/users/","/token/refresh"],R="/v2",$=`http://10.10.10.11:8080${R.startsWith("/")?R:`/${R}`}`,O=s.create({baseURL:$,headers:{"Content-Type":"application/json"},timeout:12e4}),I={request:e=>(e.metadata={startTime:Date.now()},e),response:e=>{var t;const a=Date.now(),r=(null==(t=e.config.metadata)?void 0:t.startTime)||a,o=a-r;return k.recordMetric({url:e.config.url||"",method:(e.config.method||"").toUpperCase(),startTime:r,endTime:a,duration:o,status:e.status,size:JSON.stringify(e.data).length}),e},error:e=>{var t,a,r,o,s;const n=Date.now(),i=(null==(a=null==(t=e.config)?void 0:t.metadata)?void 0:a.startTime)||n,l=n-i;return k.recordMetric({url:(null==(r=e.config)?void 0:r.url)||"",method:((null==(o=e.config)?void 0:o.method)||"").toUpperCase(),startTime:i,endTime:n,duration:l,status:(null==(s=e.response)?void 0:s.status)||0,error:e.message}),Promise.reject(e)}};O.interceptors.request.use((e=>{e=I.request(e);const t=Pe.getState().auth.authToken;return t&&(e.headers.Authorization=`Bearer ${t}`),e}),(e=>Promise.reject(e))),O.interceptors.response.use((e=>e=I.response(e)),(async e=>{if(I.error(e),e.response){const{status:t,data:a,config:r}=e.response}else e.request;if(e.response&&401===e.response.status){const t=e.config;return P.some((e=>{var a;return null==(a=t.url)?void 0:a.includes(e)}))||"/token/refresh"===t.url?(Pe.dispatch(M()),window.location.href="/login",Promise.reject(e)):C?new Promise((function(e,t){T.push({resolve:e,reject:t})})).then((e=>(t.headers.Authorization="Bearer "+e,O(t)))).catch((e=>Promise.reject(e))):(C=!0,new Promise((async(e,a)=>{try{const a=(await O.post("/token/refresh",{})).data.access_token;Pe.dispatch({type:"auth/setAuthToken",payload:a}),t.headers.Authorization="Bearer "+a,A(null,a),e(O(t))}catch(r){A(r),Pe.dispatch(M()),window.location.href="/login",a(r)}finally{C=!1}})))}return Promise.reject(e)}));const j=async e=>{const t=new URLSearchParams;t.append("username",e.username),t.append("password",e.password);return(await O.post("/auth/token",t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})).data},D=async e=>{const t=await O.get(`/users/${e}`);if(t.data&&"object"==typeof t.data&&"data"in t.data)return t.data.data;if(t.data&&"object"==typeof t.data&&"id"in t.data&&"username"in t.data)return t.data;throw new Error("Unexpected response structure for user details.")},N={authToken:null,currentUserId:null,currentUserNumericId:null,currentUser:null,userRoles:null,userRoleCodes:null,userPermissions:null,isLoadingUser:!1,loginError:null,fetchUserError:null},z=e=>{if(!e||!e.roles)return{roles:null,roleCodes:null,permissions:null};return{roles:e.roles.map((e=>e.name)),roleCodes:e.roles.map((e=>e.code)),permissions:Array.from(new Set(e.roles.flatMap((e=>{var t;return(null==(t=e.permissions)?void 0:t.map((e=>e.code)))||[]}))))}},F=r("auth/login",(async(e,{rejectWithValue:t})=>{try{const t=await j(e),{access_token:a,user:r}=t;if(!a||!r)throw new Error("Access token or user object not found in login response");const o=L(a).sub,{roles:s,roleCodes:n,permissions:i}=z(r);return{authToken:a,currentUser:r,currentUserId:o,currentUserNumericId:r.id,userRoles:s,userRoleCodes:n,userPermissions:i}}catch(a){return t(U(a))}})),V=r("auth/fetchCurrentUserDetails",(async(e,{rejectWithValue:t,dispatch:a})=>{if(null==e)return t("Numeric User ID is missing, cannot fetch details.");try{const t=await D(e),{roles:a,roleCodes:r,permissions:o}=z(t);return{currentUser:t,currentUserNumericId:t.id,currentUserId:t.username,userRoles:a,userRoleCodes:r,userPermissions:o}}catch(r){return a(M()),t(U(r))}})),Y=a({name:"auth",initialState:N,reducers:{logout:e=>{Object.assign(e,N)},setAuthToken:(e,t)=>{e.authToken=t.payload},clearLoginError:e=>{e.loginError=null},clearFetchUserError:e=>{e.fetchUserError=null},rehydrateAuth:(e,t)=>{const{isLoadingUser:a,loginError:r,fetchUserError:o,...s}=t.payload;Object.assign(e,s)}},extraReducers:e=>{e.addCase(F.pending,(e=>{e.isLoadingUser=!0,e.loginError=null,e.fetchUserError=null})).addCase(F.fulfilled,((e,t)=>{Object.assign(e,t.payload),e.isLoadingUser=!1,e.loginError=null})).addCase(F.rejected,((e,t)=>{e.isLoadingUser=!1,e.loginError=t.payload||"Login failed",Object.assign(e,N)})).addCase(V.pending,(e=>{e.isLoadingUser=!0,e.fetchUserError=null})).addCase(V.fulfilled,((e,t)=>{Object.assign(e,t.payload),e.isLoadingUser=!1,e.fetchUserError=null})).addCase(V.rejected,((e,t)=>{e.isLoadingUser=!1,e.fetchUserError=t.payload||"Failed to fetch user details"}))}}),{logout:M,setAuthToken:q,clearLoginError:x,clearFetchUserError:H,rehydrateAuth:J}=Y.actions,B=Y.reducer,Q=async e=>{try{return(await O.get("/views-optimized/departments",{params:e})).data}catch(t){return(await O.get("/views-optimized/departments",{params:e})).data}},W=async()=>{const e=[];let t=1;let a=1;do{try{const r=await Q({page:t,size:100,is_active:!0});e.push(...r.data),a=r.meta.totalPages,t++}catch(r){break}}while(t<=a);return e},G=async e=>{const t=new URLSearchParams;void 0!==e.page&&t.append("page",String(e.page)),void 0!==e.size&&t.append("size",String(e.size)),void 0!==e.parent_id&&null!==e.parent_id&&t.append("parent_id",String(e.parent_id)),e.search&&t.append("search",e.search),void 0!==e.is_active&&t.append("is_active",String(e.is_active));const a=t.toString();return(await O.get("/personnel-categories"+(a?`?${a}`:""))).data},K=async e=>(await O.post("/views-optimized/personnel-categories",e)).data,X=async(e,t)=>(await O.put(`/personnel-categories/${e}`,t)).data,Z=async e=>{await O.delete(`/personnel-categories/${e}`)},ee=async e=>{const t=new URLSearchParams;t.append("is_active",String(e));const a=t.toString();return(await O.get("/personnel-categories/tree"+(a?`?${a}`:""))).data},te=async()=>(await O.get("/personnel-categories/employee-stats")).data,ae="/positions",re=async(e={})=>{const{search:t="",size:a=100,page:r=1,is_active:o}=e,n=new URLSearchParams;t&&n.append("search",t),a&&n.append("size",a.toString()),r&&n.append("page",r.toString()),void 0!==o&&n.append("is_active",o.toString());try{return(await O.get(`${ae}?${n.toString()}`)).data}catch(i){throw s.isAxiosError(i)&&i.response,i}},oe=async e=>{try{return(await O.post(ae,e)).data}catch(t){throw s.isAxiosError(t)&&(t.response||t.request),t}},se=async(e,t)=>{try{return(await O.put(`${ae}/${e}`,t)).data}catch(a){throw s.isAxiosError(a)&&a.response,a}},ne=async e=>{try{return(await O.delete(`${ae}/${e}`)).data}catch(t){throw s.isAxiosError(t)&&t.response,t}};let ie=null,le=!1,de=null;const ce=async()=>ie||(le&&de||(le=!0,de=O.get("/views-optimized/lookup-types").then((e=>e.data&&e.data.success&&Array.isArray(e.data.data)||e.data&&Array.isArray(e.data.data)?(ie=Object.freeze([...e.data.data]),ie):e.data&&Array.isArray(e.data)?(ie=Object.freeze([...e.data]),ie):(n.error("Failed to load lookup type definitions."),null))).catch((async e=>{try{const e=await O.get("/lookup/types",{params:{size:100,page:1}});if(e.data&&Array.isArray(e.data.data))return ie=Object.freeze([...e.data.data]),ie}catch(t){}try{const e=await O.get("/config/lookup-types",{params:{size:100,page:1}});if(e.data&&Array.isArray(e.data.data))return ie=Object.freeze([...e.data.data]),ie}catch(a){}return n.error("Error loading lookup type definitions."),null})).finally((()=>{le=!1}))),de),ue=async e=>{try{const t=await ce();if(!t)return;let a=t.find((t=>t.code===e));return a||(a=t.find((t=>{var a;return(null==(a=t.code)?void 0:a.toUpperCase())===e.toUpperCase()}))),a||(a=t.find((t=>{var a;return(null==(a=t.code)?void 0:a.includes(e))||e.includes(t.code||"")}))),a||("PAY_FREQUENCY"===e?a=t.find((e=>{var t,a,r,o,s;return(null==(t=e.code)?void 0:t.includes("PAY"))||(null==(a=e.code)?void 0:a.includes("FREQUENCY"))||(null==(r=e.name)?void 0:r.includes("频率"))||(null==(o=e.name)?void 0:o.includes("薪资"))||(null==(s=e.name)?void 0:s.includes("工资"))})):"CONTRACT_STATUS"===e&&(a=t.find((e=>{var t,a,r,o;return(null==(t=e.code)?void 0:t.includes("CONTRACT"))||(null==(a=e.code)?void 0:a.includes("STATUS"))||(null==(r=e.name)?void 0:r.includes("合同"))||(null==(o=e.name)?void 0:o.includes("状态"))})))),null==a?void 0:a.code}catch(t){return}},pe="config/lookup-values",ye=async e=>{if(!e)return[];try{const t=await O.get(`/views-optimized/lookup-values-public?lookup_type_code=${e}`);return t.data&&Array.isArray(t.data.data)?t.data.data.filter((e=>!1!==e.is_active)).map((e=>({value:e.id,label:e.name||"",code:e.code||"",id:e.id,name:e.name||""}))):[]}catch(t){try{const t=await O.get(`/config/lookup-values-public?lookup_type_code=${e}`);if(t.data&&Array.isArray(t.data.data))return t.data.data.filter((e=>!1!==e.is_active)).map((e=>({value:e.id,label:e.name||"",code:e.code||"",id:e.id,name:e.name||""})))}catch(a){try{const t=await O.get(`/config/lookup-values?lookup_type_code=${e}`);if(t.data&&Array.isArray(t.data.data))return t.data.data.filter((e=>!1!==e.is_active)).map((e=>({value:e.id,label:e.name||"",code:e.code||"",id:e.id,name:e.name||""})))}catch(r){}}return[]}},ge={primeLookupTypesCache:async()=>{await ce()},getDepartmentsLookup:async()=>{try{const e=await O.get("/views-optimized/departments?is_active=true");let t;if(e.data&&Array.isArray(e.data.data))t=e.data.data;else{if(!Array.isArray(e.data))return n.error("Failed to load departments"),[];t=e.data}if(!t||0===t.length)return[];const a=t.map((e=>{const t=Number(e.id);return{id:t,name:e.name,code:e.code,is_active:e.is_active,value:t,label:e.name,parentId:e.parent_department_id?String(e.parent_department_id):void 0,children:[]}}));return(e=>{const t=new Map,a=[];return e.forEach((e=>{e.children=e.children||[],t.set(String(e.id),e)})),e.forEach((e=>{if(e.parentId&&t.has(e.parentId)){const a=t.get(e.parentId),r=a.children;r?r.push(e):a.children=[e]}else a.push(e)})),a})(a)}catch(e){return n.error("Failed to load departments: "+(e instanceof Error?e.message:"Unknown error")),[]}},getEmployeeStatusesLookup:async()=>{const e=await ue("EMPLOYEE_STATUS");return e?ye(e):(n.error("Failed to load employee statuses"),[])},getGenderLookup:async()=>{const e=await ue("GENDER");return e?ye(e):(n.error("Failed to load education levels"),[])},getEducationLevelsLookup:async()=>{const e=await ue("EDUCATION_LEVEL");return e?ye(e):(n.error("Failed to load employment types"),[])},getEmploymentTypesLookup:async()=>{const e=await ue("EMPLOYMENT_TYPE");return e?ye(e):(n.error("Failed to load contract types"),[])},getContractTypesLookup:async()=>{const e=await ue("CONTRACT_TYPE");return e?ye(e):(n.error("Failed to load marital statuses"),[])},getMaritalStatusesLookup:async()=>{const e=await ue("MARITAL_STATUS");return e?ye(e):(n.error("Failed to load political statuses"),[])},getPoliticalStatusesLookup:async()=>{const e=await ue("POLITICAL_STATUS");return e?ye(e):(n.error("Failed to load gender options"),[])},getPersonnelCategoriesLookup:async()=>{try{const e=await O.get("/views-optimized/personnel-categories?is_active=true");let t;if("data"in e.data&&Array.isArray(e.data.data))t=e.data.data;else{if(!Array.isArray(e.data))return[];t=e.data}const a=t.filter((e=>!1!==e.is_active)).map((e=>({id:Number(e.id),name:e.name,code:e.code,value:Number(e.id),label:e.name,children:[],parentId:e.parent_category_id?String(e.parent_category_id):void 0,is_active:e.is_active})));return(e=>{const t=new Map,a=[];return e.forEach((e=>{e.children=e.children||[],t.set(String(e.id),e)})),e.forEach((e=>{if(e.parentId&&t.has(e.parentId)){const a=t.get(e.parentId),r=a.children;r?r.push(e):a.children=[e]}else a.push(e)})),a})(a)}catch(e){return n.error("Failed to load personnel categories"),[]}},getLeaveTypesLookup:async()=>{const e=await ue("LEAVE_TYPE");return e?ye(e):(n.error("Failed to load leave types"),[])},getPayFrequenciesLookup:async()=>{const e=await ue("PAY_FREQUENCY");if(e)return ye(e);try{return(await he.getPayFrequenciesLookup()).map((e=>{const t=e;return{value:t.id||t.value||0,label:t.label||t.value_name||String(t.id||""),code:String(t.value||t.id||""),id:Number(t.id||0),name:t.label||t.value_name||String(t.id||"")}}))}catch(t){return n.error("Failed to load pay frequencies"),[]}},getContractStatusesLookup:async()=>{const e=await ue("CONTRACT_STATUS");if(e)return ye(e);try{return(await he.getContractStatusesLookup()).map((e=>{const t=e;return{value:t.id||t.value||0,label:t.label||t.value_name||String(t.id||""),code:String(t.value||t.id||""),id:Number(t.id||0),name:t.label||t.value_name||String(t.id||"")}}))}catch(t){return n.error("Failed to load contract statuses"),[]}},getPositionsLookup:async()=>{try{const e=await O.get("/positions/public?is_active=true");if(e.data&&Array.isArray(e.data.data)){return(e=>{const t=new Map,a=[];return e.forEach((e=>{t.set(String(e.id),{...e,children:[]})})),e.forEach((e=>{const r=e.parentId;r&&t.has(r)?t.get(r).children.push(t.get(String(e.id))):a.push(t.get(String(e.id)))})),a})(e.data.data.map((e=>({...e,id:Number(e.id),parent_position_id:e.parent_position_id?Number(e.parent_position_id):null,parentId:e.parent_position_id?String(e.parent_position_id):void 0}))))}return n.error("Failed to load position list or data is not in expected format."),[]}catch(e){return n.error("Error loading positions."),[]}},getJobPositionLevelsLookup:async()=>{const e=await ue("JOB_POSITION_LEVEL");return e?ye(e):(n.error("Failed to load positions"),[])},createLookupValue:async e=>{var t,a,r,o,s;try{const t=(await O.post("/lookup/values",e)).data.data;return{id:t.id,value:t.code||t.value||String(t.id),label:t.label||t.name||"",code:t.code,name:t.name}}catch(n){const e=(null==(r=null==(a=null==(t=null==n?void 0:n.response)?void 0:t.data)?void 0:a.detail)?void 0:r.details)||(null==(s=null==(o=null==n?void 0:n.response)?void 0:o.data)?void 0:s.detail)||n.message||"Create failed";throw new Error(e)}},updateLookupValue:async(e,t)=>{var a,r,o,s,n;try{const a=(await O.put(`/lookup/values/${e}`,t)).data.data;return{id:a.id,value:a.code||a.value||String(a.id),label:a.label||a.name||"",code:a.code,name:a.name}}catch(i){const e=(null==(o=null==(r=null==(a=null==i?void 0:i.response)?void 0:a.data)?void 0:r.detail)?void 0:o.details)||(null==(n=null==(s=null==i?void 0:i.response)?void 0:s.data)?void 0:n.detail)||i.message||"Update failed";throw new Error(e)}},deleteLookupValue:async e=>{var t,a,r,o,s;try{return await O.delete(`/lookup/values/${e}`),!0}catch(n){const e=(null==(r=null==(a=null==(t=null==n?void 0:n.response)?void 0:t.data)?void 0:a.detail)?void 0:r.details)||(null==(s=null==(o=null==n?void 0:n.response)?void 0:o.data)?void 0:s.detail)||n.message||"Delete failed";throw new Error(e)}},getLookupTypeIdByCode:async e=>{try{const t=await ce(),a=null==t?void 0:t.find((t=>t.code===e));return(null==a?void 0:a.id)||null}catch(t){return null}},getPayrollEntryStatusesLookup:async()=>{const e=await ue("PAYROLL_ENTRY_STATUS");return e?ye(e):(n.error("Failed to load job position levels"),[])},getPayrollRunStatusesLookup:async()=>{const e=await ue("PAYROLL_RUN_STATUS");return e?ye(e):(n.error("Failed to load payroll entry statuses"),[])},getPayrollPeriodStatusesLookup:async()=>{const e=await ue("PAYROLL_PERIOD_STATUS");return e?ye(e):(n.error("Failed to load payroll run statuses"),[])},getLookupValueIdByCode:async(e,t)=>{try{const a=(await ye(e)).find((e=>e.code===t));return a?Number(a.id):null}catch(a){return null}},getPayrollPeriodStatusOptions:async()=>{try{return(await O.get(`/${pe}`,{params:{lookup_type_code:"PAYROLL_PERIOD_STATUS",size:100}})).data.data.filter((e=>!1!==e.is_active)).map((e=>({value:e.id,label:e.name||e.label||"",code:e.code,id:e.id,name:e.name||e.label||""})))}catch(e){throw e}},getPayrollRunStatusOptions:async()=>{try{return(await O.get(`/${pe}`,{params:{lookup_type_code:"PAYROLL_RUN_STATUS",size:100}})).data.data.filter((e=>!1!==e.is_active)).map((e=>({value:e.id,label:e.name||e.label||"",code:e.code,id:e.id,name:e.name||e.label||""})))}catch(e){throw e}},getPayrollEntryStatusOptions:async()=>{try{return(await O.get(`/${pe}`,{params:{lookup_type_code:"PAYROLL_ENTRY_STATUS",size:100}})).data.data.filter((e=>!1!==e.is_active)).map((e=>({value:e.id,label:e.name||e.label||"",code:e.code,id:e.id,name:e.name||e.label||""})))}catch(e){throw e}},fetchLookupValuesByType:ye,fetchDepartments:Q,fetchPersonnelCategories:G,fetchPositions:re,fetchSystemLookupCode:ue,getTypeCodeBySystemCode:ue},me=e=>{const t=new URLSearchParams;for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&void 0!==e[r]&&null!==e[r]&&(Array.isArray(e[r])?e[r].forEach((e=>t.append(r,e))):t.append(r,String(e[r])));const a=t.toString();return a?`?${a}`:""},he={async getEmployees(e){try{const t=`/employees/${e?me(e):""}`;return(await O.get(t)).data}catch(t){return{data:[],meta:{page:(null==e?void 0:e.page)||1,size:(null==e?void 0:e.size)||10,total:0,totalPages:0}}}},async createEmployee(e){var t,a,r,o,s,n;try{return(await O.post("/employees/",e)).data}catch(i){i.response&&i.response.data&&i.response.data.detail||i.response&&i.response.data;const e=(null==(o=null==(r=null==(a=null==(t=i.response)?void 0:t.data)?void 0:a.detail)?void 0:r[0])?void 0:o.msg)||(null==(n=null==(s=i.response)?void 0:s.data)?void 0:n.detail)||"Failed to create employee";throw new Error(e)}},async updateEmployee(e,t){try{return(await O.put(`/employees/${e}`,t)).data}catch(a){throw a}},async deleteEmployee(e){try{await O.delete(`/employees/${e}`)}catch(t){throw t}},async bulkCreateEmployees(e,t=!1){try{return(await O.post("/employees/bulk",e,{params:{overwrite_mode:t}})).data}catch(a){throw a}},async getLookupValues(e){try{const t=await O.get(`/config/lookup-values-public?lookup_type_code=${e}`);return t.data&&Array.isArray(t.data.data)?t.data.data.map((t=>({id:t.id,lookup_type_id:t.lookup_type_id,lookup_type_code:e,value:t.code||"",label:t.name||"",display_order:t.sort_order,is_active:t.is_active}))):[]}catch(t){try{const t=await O.get(`/config/lookup-values?lookup_type_code=${e}`);if(t.data&&Array.isArray(t.data.data))return t.data.data.map((t=>({id:t.id,lookup_type_id:t.lookup_type_id,lookup_type_code:e,value:t.code||"",label:t.name||"",display_order:t.sort_order,is_active:t.is_active})))}catch(a){}return[]}},async getDepartmentsLookup(){try{const e=await O.get("/views-optimized/departments");return e.data&&Array.isArray(e.data.data)?e.data.data:Array.isArray(e.data)?e.data:[]}catch(e){try{const e=await O.get("/views-optimized/departments");return e.data&&Array.isArray(e.data.data)?e.data.data:Array.isArray(e.data)?e.data:[]}catch(t){return[]}}},async getPersonnelCategoriesLookup(e){try{const t=e?me({department_id:e}):"",a=await O.get(`/views-optimized/personnel-categories${t}`);return a.data&&Array.isArray(a.data.data)?a.data.data:[]}catch(t){return[]}},async getEmploymentTypesLookup(){try{return this.getLookupValues("EMPLOYMENT_TYPE")}catch(e){throw e}},async getContractTypesLookup(){try{return this.getLookupValues("CONTRACT_TYPE")}catch(e){throw e}},async getContractStatusesLookup(){try{return this.getLookupValues("CONTRACT_STATUS")}catch(e){throw e}},async getPayFrequenciesLookup(){try{return this.getLookupValues("PAY_FREQUENCY")}catch(e){throw e}},async getEmployeeJobHistory(e,t){try{const a=t?me(t):"";return(await O.get(`/employees/${e}/job-history/${a}`)).data}catch(a){return{data:[],meta:{page:(null==t?void 0:t.page)||1,size:(null==t?void 0:t.pageSize)||10,total:0,totalPages:0}}}},async addJobHistoryItem(e,t){try{return(await O.post(`/employees/${e}/job-history`,t)).data}catch(a){throw a}},async updateJobHistoryItem(e,t,a){try{return(await O.put(`/employees/${e}/job-history/${t}`,a)).data}catch(r){throw r}},async deleteJobHistoryItem(e,t){try{await O.delete(`/employees/${e}/job-history/${t}`)}catch(a){throw a}},async getEmployeeContracts(e,t){try{const a=t?me(t):"";return(await O.get(`/employees/${e}/contracts/${a}`)).data}catch(a){return{data:[],meta:{page:(null==t?void 0:t.page)||1,size:(null==t?void 0:t.pageSize)||10,total:0,totalPages:0}}}},async addContractItem(e,t){try{return(await O.post(`/employees/${e}/contracts`,t)).data}catch(a){throw a}},async updateContractItem(e,t,a){try{return(await O.put(`/employees/${e}/contracts/${t}`,a)).data}catch(r){throw r}},async deleteContractItem(e,t){try{await O.delete(`/employees/${e}/contracts/${t}`)}catch(a){throw a}},async getEmployeeCompensationHistory(e,t){try{const a=t?me(t):"";return(await O.get(`/employees/${e}/compensation-history/${a}`)).data}catch(a){return{data:[],meta:{page:(null==t?void 0:t.page)||1,size:(null==t?void 0:t.pageSize)||10,total:0,totalPages:0}}}},async addCompensationItem(e,t){try{return(await O.post(`/employees/${e}/compensation-history`,t)).data}catch(a){throw a}},async updateCompensationItem(e,t,a){try{return(await O.put(`/employees/${e}/compensation-history/${t}`,a)).data}catch(r){throw r}},async deleteCompensationItem(e,t){try{await O.delete(`/employees/${e}/compensation-history/${t}`)}catch(a){throw a}},async getEmployeeLeaveBalances(e,t){try{const a=t?me(t):"";return(await O.get(`/employees/${e}/leave-balances/${a}`)).data}catch(a){return{data:[],meta:{page:(null==t?void 0:t.page)||1,size:(null==t?void 0:t.pageSize)||10,total:0,totalPages:0}}}},async createLeaveBalanceItem(e,t){try{return(await O.post(`/employees/${e}/leave-balances`,t)).data}catch(a){throw a}},async adjustLeaveBalance(e,t,a){try{return(await O.put(`/employees/${e}/leave-balances/${t}/adjust`,a)).data}catch(r){throw r}},async deleteLeaveBalanceItem(e,t){try{await O.delete(`/employees/${e}/leave-balances/${t}`)}catch(a){throw a}},async getEmployeesByIds(e){if(!e||0===e.length)return{};try{const t=200,a={};for(let r=0;r<e.length;r+=t){const o=e.slice(r,r+t).join(","),s=await O.get(`/employees?ids=${o}`);s.data&&Array.isArray(s.data.data)&&s.data.data.forEach((e=>{e.id&&(a[String(e.id)]=e)}))}return a}catch(t){return{}}},async getJobPositionLevelsLookup(){try{return await this.getLookupValues("JOB_POSITION_LEVEL")}catch(e){return[]}},async getEmployeesFromView(e){try{let t={};if(e){const{page:a,size:r,...o}=e;t={...o},void 0!==a&&void 0!==r&&(t.limit=r,t.offset=(a-1)*r)}const a=`/views/employees${Object.keys(t).length>0?me(t):""}`;return(await O.get(a)).data}catch(t){return[]}},async getEmployeeByIdFromView(e){try{return(await O.get(`/views/employees/${e}`)).data}catch(t){throw t}}},ve=Object.freeze(Object.defineProperty({__proto__:null,employeeService:he},Symbol.toStringTag,{value:"Module"})),fe={genders:[],maritalStatuses:[],educationLevels:[],employmentTypes:[],employeeStatuses:[],departments:[],personnelCategories:[],actualPositions:[],jobPositionLevels:[]},we={...fe,loading:{},errors:{}};r("hrLookup/fetchLookup",(async({lookupType:e,params:t},{dispatch:a,getState:r})=>{r();const o="all"===e?Object.keys(fe):[e];for(const n of o){a(be.actions.setLoading({type:n,isLoading:!0})),a(be.actions.setError({type:n,error:null}));try{let e=[];switch(n){case"genders":e=await he.getLookupValues("GENDER");break;case"maritalStatuses":e=await he.getLookupValues("MARITAL_STATUS");break;case"educationLevels":e=await he.getLookupValues("EDUCATION_LEVEL");break;case"employmentTypes":e=await he.getEmploymentTypesLookup();break;case"employeeStatuses":e=await he.getLookupValues("EMPLOYEE_STATUS");break;case"departments":e=await he.getDepartmentsLookup();break;case"personnelCategories":e=await he.getPersonnelCategoriesLookup(t);break;case"actualPositions":e=await ge.getPositionsLookup();break;case"jobPositionLevels":e=await he.getJobPositionLevelsLookup();break;default:}a(be.actions.setLookupData({type:n,data:e}))}catch(s){a(be.actions.setError({type:n,error:s.message||`Failed to fetch ${n}`}))}finally{a(be.actions.setLoading({type:n,isLoading:!1}))}}}));const be=a({name:"hrLookup",initialState:we,reducers:{setLoading:(e,t)=>{e.loading[t.payload.type]=t.payload.isLoading},setError:(e,t)=>{e.errors[t.payload.type]=t.payload.error},setLookupData:(e,t)=>{e[t.payload.type]=t.payload.data}}}),{setLoading:Se,setError:Ee,setLookupData:_e}=be.actions,Le=be.reducer,ke=async e=>{try{return(await O.get("/config/payroll-component-definitions",{params:e})).data}catch(t){throw t}},Ce=r("payrollConfig/fetchComponentDefinitions",(async(e,{rejectWithValue:t})=>{try{const t={size:100,is_active:!0,...e},a=await ke(t);return a.data&&a.data.length>0?a.data:[]}catch(a){return t(a.message||"Failed to fetch component definitions")}})),Te=a({name:"payrollConfig",initialState:{componentDefinitions:[],loading:!1,error:null},reducers:{},extraReducers:e=>{e.addCase(Ce.pending,(e=>{e.loading=!0,e.error=null})).addCase(Ce.fulfilled,((e,t)=>{e.componentDefinitions=t.payload,e.loading=!1,e.error=null})).addCase(Ce.rejected,((e,t)=>{e.loading=!1,e.error=t.payload||"Failed to fetch component definitions",e.componentDefinitions=[]}))}}).reducer,Ae=()=>{try{const e=localStorage.getItem("chatbot-config-redux-storage");if(null===e)return;return JSON.parse(e)}catch(e){return}},Ue=(()=>{const e=Ae(),t=(()=>{try{const e=localStorage.getItem("auth-storage");if(null===e)return;return JSON.parse(e)}catch(e){return}})(),a={};return e&&(a.chatbotConfig={...e,isLoading:!0}),t&&(a.auth=t),Object.keys(a).length>0?a:void 0})(),Pe=o({reducer:{auth:B,hrLookup:Le,payrollConfig:Te,chatbotConfig:y},preloadedState:Ue});if(Ue&&Ue.chatbotConfig){const e=Ae();e?Pe.dispatch(d(e)):Pe.dispatch(c())}else Pe.dispatch(c());Ue&&Ue.auth&&Pe.dispatch(J(Ue.auth));let Re=Pe.getState().auth;Pe.subscribe((()=>{const e=Pe.getState(),t=Re;if(Re=e.auth,Re!==t)try{const e={authToken:Re.authToken,currentUserId:Re.currentUserId,currentUserNumericId:Re.currentUserNumericId,currentUser:Re.currentUser,userRoles:Re.userRoles,userRoleCodes:Re.userRoleCodes,userPermissions:Re.userPermissions};localStorage.setItem("auth-storage",JSON.stringify(e))}catch(a){}}));export{S as A,J as B,V as C,ce as D,M as E,x as F,F as G,i as H,u as I,p as J,ee as K,Pe as L,ve as M,ge as a,O as b,ke as c,Q as d,he as e,U as f,D as g,G as h,te as i,L as j,Z as k,j as l,K as m,re as n,ne as o,oe as p,se as q,W as r,h as s,g as t,X as u,m as v,v as w,f as x,w as y,b as z};
